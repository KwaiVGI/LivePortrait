# LivePortrait: ã‚¹ãƒ†ãƒƒãƒãƒ³ã‚°ã¨ãƒªã‚¿ãƒ¼ã‚²ãƒ†ã‚£ãƒ³ã‚°åˆ¶å¾¡ã«ã‚ˆã‚‹åŠ¹ç‡çš„ãªãƒãƒ¼ãƒˆãƒ¬ãƒ¼ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

<div align='center'>
    <a href='https://github.com/cleardusk' target='_blank'><strong>Jianzhu Guo</strong></a><sup> 1â€ </sup>&emsp;
    <a href='https://github.com/KwaiVGI' target='_blank'><strong>Dingyun Zhang</strong></a><sup> 1,2</sup>&emsp;
    <a href='https://github.com/KwaiVGI' target='_blank'><strong>Xiaoqiang Liu</strong></a><sup> 1</sup>&emsp;
    <a href='https://github.com/KwaiVGI' target='_blank'><strong>Zhizhou Zhong</strong></a><sup> 1,3</sup>&emsp;
    <a href='https://scholar.google.com.hk/citations?user=_8k1ubAAAAAJ' target='_blank'><strong>Yuan Zhang</strong></a><sup> 1</sup>&emsp;
</div>

<div align='center'>
    <a href='https://scholar.google.com/citations?user=P6MraaYAAAAJ' target='_blank'><strong>Pengfei Wan</strong></a><sup> 1</sup>&emsp;
    <a href='https://openreview.net/profile?id=~Di_ZHANG3' target='_blank'><strong>Di Zhang</strong></a><sup> 1</sup>&emsp;
</div>

<div align='center'>
    <sup>1 </sup>Kuaishou Technology&emsp; <sup>2 </sup>ä¸­å›½ç§‘å­¦æŠ€è¡“å¤§å­¦&emsp; <sup>3 </sup>å¾©æ—¦å¤§å­¦&emsp;
</div>

<br>
<div align="center">
  <!-- <a href='LICENSE'><img src='https://img.shields.io/badge/license-MIT-yellow'></a> -->
  <a href='https://arxiv.org/pdf/2407.03168'><img src='https://img.shields.io/badge/arXiv-LivePortrait-red'></a>
  <a href='https://liveportrait.github.io'><img src='https://img.shields.io/badge/Project-LivePortrait-green'></a>
  <a href='https://huggingface.co/spaces/KwaiVGI/liveportrait'><img src='https://img.shields.io/badge/%F0%9F%A4%97%20Hugging%20Face-Spaces-blue'></a>
</div>
<br>

<p align="center">
  <img src="../assets/docs/showcase2.gif" alt="showcase">
  <br>
  ğŸ”¥ ã‚ˆã‚Šå¤šãã®çµæœã«ã¤ã„ã¦ã¯ã€<a href="https://liveportrait.github.io/"><strong>ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸</strong></a>ã‚’ã”è¦§ãã ã•ã„ ğŸ”¥
</p>



## ğŸ”¥ æ›´æ–°æƒ…å ±
- **`2024/07/04`**: ğŸ”¥ æ¨è«–ã‚³ãƒ¼ãƒ‰ã¨ãƒ¢ãƒ‡ãƒ«ã®åˆæœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒªãƒªãƒ¼ã‚¹ã—ã¾ã—ãŸã€‚ç¶™ç¶šçš„ã«æ›´æ–°ã—ã¦ã„ã‚‹ã®ã§ã€ã”æœŸå¾…ãã ã•ã„ï¼
- **`2024/07/04`**: ğŸ˜Š [ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸](https://liveportrait.github.io) ã¨ [arXiv](https://arxiv.org/pdf/2407.03168) ã§ã®æŠ€è¡“ãƒ¬ãƒãƒ¼ãƒˆã‚’ãƒªãƒªãƒ¼ã‚¹ã—ã¾ã—ãŸã€‚

## ã¯ã˜ã‚ã«
**LivePortrait** ã¨å‘¼ã°ã‚Œã‚‹ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã«ã¯ã€è«–æ–‡ [LivePortrait: Efficient Portrait Animation with Stitching and Retargeting Control](https://arxiv.org/pdf/2407.03168) ã®å…¬å¼ PyTorch å®Ÿè£…ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚
ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã¯ç©æ¥µçš„ã«æ›´æ–°ãŠã‚ˆã³æ”¹å–„ã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒã‚°ã‚’ç™ºè¦‹ã—ãŸå ´åˆã‚„ææ¡ˆãŒã‚ã‚‹å ´åˆã¯ã€å•é¡Œã‚’æèµ·ã™ã‚‹ã‹ã€ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆPRï¼‰ã‚’é€ä¿¡ã—ã¦ãã ã•ã„ğŸ’–ã€‚

## ğŸ”¥ ã¯ã˜ã‚ã«
### 1. ã‚³ãƒ¼ãƒ‰ã®ã‚¯ãƒ­ãƒ¼ãƒ³ã‚’ä½œæˆã—ã€ç’°å¢ƒã‚’æº–å‚™ã™ã‚‹
```bash
git clone https://github.com/KwaiVGI/LivePortrait
cd LivePortrait

# conda ã‚’ä½¿ç”¨ã—ã¦ç’°å¢ƒã‚’ä½œæˆã™ã‚‹
conda create -n LivePortrait python==3.9.18
conda activate LivePortrait
# pip ã§ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
pip install -r requirements.txt
```

### 2. å­¦ç¿’æ¸ˆã¿é‡ã¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
å­¦ç¿’æ¸ˆã¿ã® LivePortrait é‡ã¿ã¨ InsightFace ã®é¡”æ¤œå‡ºãƒ¢ãƒ‡ãƒ«ã¯ã€[Google Drive](https://drive.google.com/drive/folders/1UtKgzKjFAOmZkhNK-OYT0caJ_w2XAnib) ã¾ãŸã¯ [Baidu Yun](https://pan.baidu.com/s/1MGctWmNla_vZxDbEp2Dtzw?pwd=z5cn) ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚ã™ã¹ã¦ã®é‡ã¿ã‚’1ã¤ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¾ã¨ã‚ã¦ã„ã¾ã™ğŸ˜Šã€‚è§£å‡ã—ã¦ `./pretrained_weights` ã«é…ç½®ã—ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ãŒä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚
```text
pretrained_weights
â”œâ”€â”€ insightface
â”‚   â””â”€â”€ models
â”‚       â””â”€â”€ buffalo_l
â”‚           â”œâ”€â”€ 2d106det.onnx
â”‚           â””â”€â”€ det_10g.onnx
â””â”€â”€ liveportrait
    â”œâ”€â”€ base_models
    â”‚   â”œâ”€â”€ appearance_feature_extractor.pth
    â”‚   â”œâ”€â”€ motion_extractor.pth
    â”‚   â”œâ”€â”€ spade_generator.pth
    â”‚   â””â”€â”€ warping_module.pth
    â”œâ”€â”€ landmark.onnx
    â””â”€â”€ retargeting_models
        â””â”€â”€ stitching_retargeting_module.pth
```

### 3. æ¨è«– ğŸš€

```bash
python inference.py
```

ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒæ­£å¸¸ã«å®Ÿè¡Œã•ã‚Œã‚‹ã¨ã€`animations/s6--d0_concat.mp4` ã¨ã„ã†åå‰ã®å‡ºåŠ› mp4 ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã€é§†å‹•ãƒ“ãƒ‡ã‚ªã€å…¥åŠ›ç”»åƒã€ç”Ÿæˆã•ã‚ŒãŸçµæœãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

<p align="center">
  <img src="../assets/docs/inference.gif" alt="image">
</p>

ã¾ãŸã¯ã€`-s` ãŠã‚ˆã³ `-d` å¼•æ•°ã‚’æŒ‡å®šã—ã¦å…¥åŠ›ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

```bash
python inference.py -s assets/examples/source/s9.jpg -d assets/examples/driving/d0.mp4

# ã¾ãŸã¯ã€è²¼ã‚Šä»˜ã‘ã‚’ç„¡åŠ¹ã«ã™ã‚‹
python inference.py -s assets/examples/source/s9.jpg -d assets/examples/driving/d0.mp4 --no_flag_pasteback

# è©³ç´°ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹
python inference.py -h
```

**ã‚ˆã‚Šèˆˆå‘³æ·±ã„çµæœã¯ã€[ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸](https://liveportrait.github.io)** ğŸ˜Š ã«ã‚ã‚Šã¾ã™ã€‚

### 4. Gradio ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

ã‚ˆã‚Šè‰¯ã„ä½“é¨“ã®ãŸã‚ã«ã€Gradio ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚‚æä¾›ã—ã¦ã„ã¾ã™ã€‚

```bash
python app.py
```

### 5. æ¨è«–é€Ÿåº¦ã®è©•ä¾¡ ğŸš€ğŸš€ğŸš€
å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®æ¨è«–é€Ÿåº¦ã‚’è©•ä¾¡ã™ã‚‹ãŸã‚ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚‚æä¾›ã—ã¦ã„ã¾ã™ã€‚

```bash
python speed.py
```

ä»¥ä¸‹ã¯ã€`torch.compile` ã‚’ä½¿ç”¨ã—ãŸãƒã‚¤ãƒ†ã‚£ãƒ– PyTorch ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã—ã¦ RTX 4090 GPU ã§ 1 ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’æ¨è«–ã—ãŸçµæœã§ã™ã€‚

| ãƒ¢ãƒ‡ãƒ«                             | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•°(M) | ãƒ¢ãƒ‡ãƒ«ã‚µã‚¤ã‚º(MB) | æ¨è«–æ™‚é–“(ms) |
|-----------------------------------|:-------------:|:--------------:|:-------------:|
| Appearance Feature Extractor      |     0.84      |       3.3      |     0.82      |
| Motion Extractor                  |     28.12     |       108      |     0.84      |
| Spade Generator                   |     55.37     |       212      |     7.59      |
| Warping Module                    |     45.53     |       174      |     5.21      |
| Stitching and Retargeting Modules|     0.23      |       2.3      |     0.31      |

*æ³¨: Stitching and Retargeting Modules ã®å€¤ã¯ã€3 ã¤ã® MLP ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•°ã¨åˆè¨ˆæ¨è«–æ™‚é–“ã®åˆè¨ˆã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚*

## Docker Composeã‚’ä½¿ç”¨ã—ãŸèµ·å‹•

LivePortraitã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’Docker Composeã§ç°¡å˜ã«èµ·å‹•ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ãƒªãƒã‚¸ãƒˆãƒªã«ã¯ã™ã§ã«`docker-compose.yml`ãƒ•ã‚¡ã‚¤ãƒ«ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ä»¥ä¸‹ã®æ‰‹é †ã«å¾“ã£ã¦ãã ã•ã„ï¼š

1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

2. Docker Composeã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã—ã¾ã™ï¼š

```bash
docker-compose up
```

ã“ã‚Œã«ã‚ˆã‚Šã€LivePortraitã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒDockerã‚³ãƒ³ãƒ†ãƒŠå†…ã§èµ·å‹•ã—ã€ãƒãƒ¼ãƒˆ8890ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

> [!NOTE]
> ã“ã®è¨­å®šã¯NVIDIA GPUã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚GPUãŒåˆ©ç”¨ã§ããªã„å ´åˆã¯ã€`docker-compose.yml`ãƒ•ã‚¡ã‚¤ãƒ«ã®`deploy`ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’é©å®œèª¿æ•´ã—ã¦ãã ã•ã„ã€‚

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒèµ·å‹•ã—ãŸã‚‰ã€ã‚¦ã‚§ãƒ–ãƒ–ãƒ©ã‚¦ã‚¶ã§`http://localhost:8890`ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦Gradioã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚


## è¬è¾
ã‚ªãƒ¼ãƒ—ãƒ³ãªç ”ç©¶ã¨è²¢çŒ®ã«å¯¾ã—ã¦ã€[FOMM](https://github.com/AliaksandrSiarohin/first-order-model)ã€[Open Facevid2vid](https://github.com/zhanglonghao1992/One-Shot_Free-View_Neural_Talking_Head_Synthesis)ã€[SPADE](https://github.com/NVlabs/SPADE)ã€[InsightFace](https://github.com/deepinsight/insightface) ãƒªãƒã‚¸ãƒˆãƒªã®è²¢çŒ®è€…ã«æ„Ÿè¬ã—ã¾ã™ã€‚

## å¼•ç”¨ ğŸ’–
LivePortrait ãŒã‚ãªãŸã®ç ”ç©¶ã«å½¹ç«‹ã£ãŸå ´åˆã¯ã€ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ğŸŒŸã—ã€ä»¥ä¸‹ã® BibTeX ã‚’ä½¿ç”¨ã—ã¦ç§ãŸã¡ã®ä»•äº‹ã‚’å¼•ç”¨ã—ã¦ãã ã•ã„ã€‚
```bibtex
@article{guo2024live,
  title   = {LivePortrait: Efficient Portrait Animation with Stitching and Retargeting Control},
  author  = {Jianzhu Guo and Dingyun Zhang and Xiaoqiang Liu and Zhizhou Zhong and Yuan Zhang and Pengfei Wan and Di Zhang},
  year    = {2024},
  journal = {arXiv preprint:2407.03168},
}
```
